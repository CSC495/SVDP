<html xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:jr="http://jasperreports.sourceforge.net/jasperreports">
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>JasperReports 4.6.0 - jCharts Component Sample</title>
<style type="text/css">
.title {
	font-family: Arial, Verdana, Helvetica, sans-serif;
	font-size: 28px;
	font-weight: normal;
}

.toc {
	font-family: Courier New, Courier, serif;
	font-size: 12px;
	font-weight: normal;
}

.name {
	font-family: Courier New, Courier, serif;
	font-size: 16px;
	font-weight: bold;
}

.label {
	font-family: Arial, Verdana, Helvetica, sans-serif;
	font-size: 12px;
	font-weight: bold;
	font-style: italic;
}

.description {
	font-family: Arial, Verdana, Helvetica, sans-serif;
	font-size: 12px;
	font-weight: normal;
}

.value {
	font-family: Courier New, Courier, serif;
	font-size: 12px;
	font-weight: normal;
}

.element {
	font-family: Courier New, Courier, serif;
	font-size: 12px;
	font-weight: normal;
}

.attribute {
	font-family: Courier New, Courier, serif;
	font-size: 12px;
	font-weight: bold;
}

.code {
	font-family: Courier New, Courier, serif;
	font-size: 12px;
	font-weight: normal;
}

.copy {
	font-decoration: none;
	font-family: Verdana, Arial, Helvetica, sans-serif;
	font-size: 8pt;
	font-style: normal;
	color: #000000;
}

.subtitle {
	font-family: inherit;
	font-size: inherit;
	font-style: inherit;
	font-weight: bold;
	text-decoration: none;
	color: inherit;
}

</style>
</head>
<body bgcolor="#FFFFFF">
<a name="top"></a>
<table cellspacing="0" cellpadding="0" border="0" width="100%">
<tr>
<td colspan="2" align="right"><span class="element"><a href="../../JasperReports-Ultimate-Guide-3.pdf">JasperReports Ultimate Guide</a> - <a href="../../sample.reference.html">Sample Reference</a> - <a href="../../schema.reference.html">Schema Reference</a> - <a href="../../config.reference.html">Configuration Reference</a> - <a href="http://jasperreports.sourceforge.net/api/index.html">API (Javadoc)</a></span>
<br>
</td>
</tr>
<tr>
<td colspan="2">
<hr size="1">
</td>
</tr>
<tr valign="middle">
<td nowrap="true"><span class="title">JasperReports - jCharts Component Sample (version 4.6.0)</span></td><td align="right"><img src="../../resources/jasperreports.png" border="0"></td>
</tr>
<tr>
<td colspan="2">
<hr size="1">
</td>
</tr>
</table>
<br>
<span class="description"><span class="description">Shows how jCharts components can be included in reports.</span></span>
<br>
<br>
<span class="element"><a href="http://sourceforge.net/projects/jasperreports/files/jasperreports/JasperReports%204.6.0/jasperreports-4.6.0-project.zip/download" target="_blank">Download All Sample Source Files</a></span>
<br>
<span class="element"><a href="http://jasperforge.org/scm/viewvc.php/tags/jr-4-6-0/jasperreports/demo/samples/jchartscomponent/?root=jasperreports" target="_blank">Browse Sample Source Files on SVN</a></span>
<table width="100%" border="0" cellpadding="0" cellspacing="0">
<tr>
<td style="width: 20px;">
<br>
</td><td>
<br>
</td>
</tr>
<tr>
<td colspan="2"><span class="label">Main Features in This Sample</span></td>
</tr>
<tr>
<td>
<br>
</td><td><span class="element"><a href="#jchartscomponent">Implementing Custom Components to Embed Third Party Visualisation Tools (jCharts Library)</a></span></td>
</tr>
</table>
<table width="100%" cellspacing="0" cellpadding="0" border="0">
<tr>
<td><img src="../../resources/px.gif" border="0" width="20" height="1"></td><td><img src="../../resources/px.gif" border="0" width="20" height="1"></td><td><img src="../../resources/px.gif" border="0" width="20" height="1"></td><td><img src="../../resources/px.gif" border="0" width="20" height="1"></td><td width="80%">
<br>
</td><td width="20%">
<br>
</td>
</tr>
<tr>
<td colspan="6" align="right"><a name="jchartscomponent"></a><a href="#top" class="toc">top</a></td>
</tr>
<tr>
<td colspan="6">
<hr size="1">
</td>
</tr>
<tr valign="top">
<td><img src="../../resources/jr-16x16.png" border="0"></td><td colspan="4"><span class="name">Implementing Custom Components to Embed Third Party Visualisation Tools (jCharts Library)</span></td><td align="right"><span class="copy">Documented by 
	<a href="mailto:shertage@users.sourceforge.net" class="copy">Sanda Zaharia</a></span></td>
</tr>
<tr>
<td colspan="6">
<br>
</td>
</tr>
<tr valign="top">
<td>
<br>
</td><td nowrap="true"><span class="label">Description / Goal</span></td><td>
<br>
</td><td colspan="3"><span class="description">
How to implement a custom component to wrap charts rendered by the <a href="http://jcharts.sourceforge.net/" target="_blank" class="element">jCharts</a> library.
    </span></td>
</tr>
<tr valign="top">
<td>
<br>
</td><td colspan="1"><span class="label">Since</span></td><td>
<br>
</td><td colspan="3"><span class="description">3.1.0</span></td>
</tr>
<tr valign="top">
<td>
<br>
</td><td nowrap="true"><span class="label">Other Samples</span></td><td>
<br>
</td><td colspan="3">
<table width="100%" cellspacing="0" cellpadding="0" border="0">
<tr>
<td><span class="element"><a href="../openflashchart/index.html">/demo/samples/openflashchart</a></span></td>
</tr>
</table>
</td>
</tr>
<tr>
<td colspan="6">
<br>
</td>
</tr>
<tr>
<td>
<br>
</td><td colspan="5"><span class="description">
<a name="overview" href="../../sample.reference/jchartscomponent/index.html#overview" class="subtitle">The JCharts Component - Overview</a>

<br>

<br>
This sample contains an axis chart component implementation based on the <a href="http://jcharts.sourceforge.net/" target="_blank" class="element">jCharts</a> library, that illustrates how charts 
generated with 3-rd party APIs can be embedded in reports generated with the JasperReports library. To make such an integration possible, the chart component provides 
its specific XSD schema in the <span class="code"><code>src/jcharts/charts.xsd</code></span> file.
<br>
On the API side, the chart component is represented by the jcharts.AxisChartComponent class, which exposes the members declared in schema. When the report is filled, 
a <span class="element"><a href="http://jasperreports.sourceforge.net/api/net/sf/jasperreports/engine/JRImageRenderer.html" target="_blank">JRImageRenderer</a></span> instance is created in order to generate a chart image to be included into the report. 
The image representation of the chart was preferred instead of the chart itself because AxisChart objects fail on serialization.
<br>

<br>

<a name="schema" href="../../sample.reference/jchartscomponent/index.html#schema" class="subtitle">The JCharts Component - Schema</a>

<br>

<br>
Here is the JRXML schema for the axis chart component:
<pre>
&lt;element name="axisChart" substitutionGroup="jr:component"&gt;
  &lt;complexType&gt;
    &lt;complexContent&gt;
      &lt;extension base="jr:componentType"&gt;
        &lt;sequence&gt;
          &lt;element ref="jc:axisDataset"/&gt;
          &lt;element name="legendLabelExpression"&gt;
            &lt;complexType mixed="true"/&gt;
          &lt;/element&gt;
        &lt;/sequence&gt;
        &lt;attribute name="areaColor" type="string" use="required"/&gt;
        &lt;attribute name="evaluationTime" type="jr:basicEvaluationTime" use="optional" default="Now"/&gt;
        &lt;attribute name="evaluationGroup" type="string" use="optional"/&gt;
      &lt;/extension&gt;
    &lt;/complexContent&gt;
  &lt;/complexType&gt;
&lt;/element&gt;

&lt;element name="axisDataset"&gt;
  &lt;complexType&gt;
    &lt;sequence&gt;
      &lt;element ref="jr:dataset" minOccurs="0" maxOccurs="1"/&gt;
      &lt;element name="labelExpression"&gt;
        &lt;complexType mixed="true"/&gt;
      &lt;/element&gt;
      &lt;element name="valueExpression"&gt;
        &lt;complexType mixed="true"/&gt;
      &lt;/element&gt;
    &lt;/sequence&gt;
  &lt;/complexType&gt;
&lt;/element&gt;</pre>
A well defined axis chart configuration contains:
<ul>

<li>an <span class="code"><code>axisDataset</code></span> - the area chart dataset characterized by the <span class="code"><code>dataset</code></span>, <span class="code"><code>labelExpression</code></span> and <span class="code"><code>valueExpression</code></span>.</li>

<li>a <span class="code"><code>legendLabelExpression</code></span> - the expression used to set labels in the chart legend.</li>

</ul>
and provide the following attributes:
<ul>

<li>
<span class="code"><code>areaColor</code></span> - the color of the area. Allowed values are either the color hexadecimal RGB notation, or color names preset in the 
<span class="element"><a href="http://jasperreports.sourceforge.net/api/net/sf/jasperreports/engine/type/ColorEnum.html" target="_blank">ColorEnum</a></span>.</li>

<li>
<span class="code"><code>evaluationTime</code></span> and <span class="code"><code>evaluationTime</code></span> with the same meaning as for built-in report elements.</li>

</ul>

<a name="embedding" href="../../sample.reference/jchartscomponent/index.html#embedding" class="subtitle">Embedding The JCharts Component</a>

<br>

<br>
The <span class="code"><code>src/jasperreports_extension.properties</code></span> file contains the following entries:
<ul>

<li>
<span class="code"><code>net.sf.jasperreports.extension.registry.factory.charts=net.sf.jasperreports.extensions.SpringExtensionsRegistryFactory</code></span>
</li>

<li>
<span class="code"><code>net.sf.jasperreports.extension.charts.spring.beans.resource=jcharts/chart_beans.xml</code></span>
</li>

</ul>
Hence this component will be registered as Spring-based extension, in accordance with beans in the <span class="code"><code>src/jcharts/chart_beans.xml</code></span>:
<pre>
&lt;bean id="componentsBundle" class="net.sf.jasperreports.engine.component.DefaultComponentsBundle"&gt;
  &lt;property name="xmlParser"&gt;
    &lt;ref local="xmlParser"/&gt;
  &lt;/property&gt;
  &lt;property name="componentManagers"&gt;
    &lt;map&gt;
      &lt;entry key="axisChart"&gt;
        &lt;ref local="axisChartManager"/&gt;
      &lt;/entry&gt;
    &lt;/map&gt;
  &lt;/property&gt;
&lt;/bean&gt;

&lt;bean id="xmlParser" class="net.sf.jasperreports.engine.component.DefaultComponentXmlParser"&gt;
  &lt;property name="namespace"&gt;
    &lt;value&gt;http://jasperreports.sourceforge.net/jasperreports/jcharts&lt;/value&gt;
  &lt;/property&gt;
  &lt;property name="publicSchemaLocation"&gt;
    &lt;value&gt;http://jasperreports.sourceforge.net/dtds/charts.xsd&lt;/value&gt;
  &lt;/property&gt;
  &lt;property name="internalSchemaResource"&gt;
    &lt;value&gt;jcharts/charts.xsd&lt;/value&gt;
  &lt;/property&gt;
  &lt;property name="digesterConfigurer"&gt;
    &lt;bean class="jcharts.ChartsDigester"/&gt;
  &lt;/property&gt;
&lt;/bean&gt;

&lt;bean id="axisChartManager" class="net.sf.jasperreports.engine.component.DefaultComponentManager"&gt;
  &lt;property name="componentCompiler"&gt;
    &lt;bean class="jcharts.AxisChartCompiler"/&gt;
  &lt;/property&gt;
  &lt;property name="componentXmlWriter"&gt;
    &lt;bean class="jcharts.AxisChartXmlWriter"/&gt;
  &lt;/property&gt;
  &lt;property name="componentFillFactory"&gt;
    &lt;bean class="jcharts.AxisChartFillFactory"/&gt;
  &lt;/property&gt;
&lt;/bean&gt;</pre>
The <span class="code"><code>src/jcharts</code></span> directory contains all necessary implementation APIs for this component:
<ul>

<li>
<span class="code"><code>AxisChartCompiler.java</code></span> - the compiler class for the axis chart component</li>

<li>
<span class="code"><code>AxisChartComponent.java</code></span> - the axis chart component</li>

<li>
<span class="code"><code>AxisChartFillFactory.java</code></span> - the fill factory class for the component</li>

<li>
<span class="code"><code>AxisChartXmlFactory.java</code></span> - the XML factory class for the component</li>

<li>
<span class="code"><code>AxisChartXmlWriter.java</code></span>- the component XML writer</li>

<li>
<span class="code"><code>AxisDataset.java</code></span> - the axis dataset element</li>

<li>
<span class="code"><code>AxisDatasetXmlFactory.java</code></span> - the XML factory class for the axis dataset</li>

<li>
<span class="code"><code>ChartsDigester.java</code></span> - the specific Digester class for the axis chart component</li>

<li>
<span class="code"><code>CompiledAxisDataset.java</code></span> - the compiled axis dataset class</li>

<li>
<span class="code"><code>DesignAxisDataset.java</code></span> - the design axis dataset object</li>

<li>
<span class="code"><code>FillAxisChart.java</code></span> - the fill object related to the axis chart</li>

<li>
<span class="code"><code>FillAxisDataset.java</code></span> - the fill object related to the axis dataset</li>

</ul>

<a name="sample" href="../../sample.reference/jchartscomponent/index.html#sample" class="subtitle">The JCharts Component - Sample</a>

<br>

<br>
An example of how to use the axis chart component is illustrated in the <span class="code"><code>reports/AxisChart.jrxml</code></span> template:
<pre>
&lt;variable name="Value" class="java.lang.Double"&gt;
  &lt;variableExpression&gt;
    new Double(Math.pow($V{REPORT_COUNT}.doubleValue(), 4 - Math.log($V{REPORT_COUNT}.doubleValue())))
  &lt;/variableExpression&gt;
&lt;/variable&gt;

...

&lt;componentElement&gt;
  &lt;reportElement x="0" y="70" width="500" height="300"/&gt;
  &lt;jc:axisChart xmlns:jc="http://jasperreports.sourceforge.net/jasperreports/jcharts"
      evaluationTime="Report" areaColor="cyan"&gt;
    &lt;jc:axisDataset&gt;
      &lt;dataset/&gt;
      &lt;jc:labelExpression&gt;$V{REPORT_COUNT}.toString()&lt;/jc:labelExpression&gt;
      &lt;jc:valueExpression&gt;$V{Value}&lt;/jc:valueExpression&gt;
    &lt;/jc:axisDataset&gt;
    &lt;jc:legendLabelExpression&gt;"Data"&lt;/jc:legendLabelExpression&gt;
  &lt;/jc:axisChart&gt;
&lt;/componentElement&gt;</pre>
The report is filled using an empty data source with 12 records, as shown in <span class="code"><code>src/JChartsApp.java</code></span>:
<pre>
public void fill() throws JRException
{
  long start = System.currentTimeMillis();
  JasperFillManager.fillReportToFile("build/reports/AxisChart.jasper", null, new JREmptyDataSource(12));
  System.err.println("Filling time : " + (System.currentTimeMillis() - start));
}</pre>
The output in this case will be an area chart with 12 integer values on the x-axis. The related y-values are calculated in the <span class="code"><code>$V{Value}</code></span> 
variable expression. The output area color is cyan and the legend will be labeled <span class="code"><code>"Data"</code></span>.
<br>

<br>

<b>Running the Sample</b>

<br>

<br>
Running the sample requires the <a href="http://ant.apache.org/" target="_blank" class="element">Apache Ant</a> library. Make sure that <span class="code"><code>ant</code></span> is already installed on your system (version 1.5 or later).
<br>
In a command prompt/terminal window set the current folder to <span class="code"><code>demo/samples/jchartscomponent</code></span> within the JasperReports source project and run the <span class="code"><code>&gt; ant test view</code></span> command.
<br>
It will generate all supported document types containing the sample report in the <span class="code"><code>demo/samples/jchartscomponent/build/reports</code></span> directory. 
<br>
Then the report will open in the JasperReports internal viewer.

    </span></td>
</tr>
<tr>
<td colspan="6">
<br>
</td>
</tr>
</table>
<br>
<table cellspacing="0" cellpadding="0" border="0" width="100%">
<tr>
<td>
<hr size="1">
</td>
</tr>
<tr>
<td align="center"><span class="copy">&copy; 2001-<script language="javascript">document.write((new Date()).getFullYear())</script> Jaspersoft Corporation <a href="http://www.jaspersoft.com" target="_blank" class="copy">www.jaspersoft.com</a></span></td>
</tr>
</table>
</body>
</html>
