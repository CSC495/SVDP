<?php
// Set page character encoding to Unicode.
$frontController = Zend_Controller_Front::getInstance();
$response        = $frontController->getResponse();
$charset         = $this->getEncoding();

$response->setHeader('Content-type', "text/html; charset=$charset");
$this->headMeta()->setCharset($charset);

// Set the page title.
$this->headTitle($this->pageTitle)
     ->headTitle("Society of St. Vincent de Paul")
     ->setSeparator(" :: ");

// Use the main stylesheet.
$this->headLink()->prependStylesheet($this->baseUrl('main.css'), 'all');

// Render <head> elements.
echo $this->doctype(),    "\n";
echo $this->headMeta(),   "\n";
echo $this->headTitle(),  "\n";
echo $this->headLink(),   "\n";
echo $this->headScript(), "\n";

// Get any unread flash messages.
$flashMessenger = Zend_Controller_Action_HelperBroker::getStaticHelper('FlashMessenger');

if ($flashMessenger->hasCurrentMessages()) {
    $messages = $flashMessenger->getCurrentMessages();
    $flashMessenger->clearCurrentMessages();
} else {
    $messages = $flashMessenger->getMessages();
}

// Fetch user role for later use.
$auth = Zend_Auth::getInstance();
$role = $auth->hasIdentity() ? $auth->getIdentity()->role : App_Roles::GENERAL;
?>
<header>
    <h1>Society of St. Vincent de Paul :: <?php echo $this->escape($this->pageTitle); ?></h1>
</header>
<div class="nav nav-tabs nav-stacked">
<?php echo $this->partial("navigation/$role.phtml"); ?>
</div>
<?php
foreach ($messages as $message) {
    // Write each flash message as a top-level alert.
    echo '<p class=alert>' . $this->escape($message) . '</p>';
}
?>
<div id=content>
    <?php
        // Write out page content specific to the current controller/action.
        echo $this->layout()->content;
    ?>
</div>
